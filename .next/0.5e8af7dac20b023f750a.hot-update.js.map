{"version":3,"file":"0.5e8af7dac20b023f750a.hot-update.js","sources":["webpack:///actions/authActions.js","webpack:///lib/sso-auth.js"],"sourcesContent":["import { ssoLogin, ssoLogout, ssoUser } from '../lib/sso-auth';\nimport { setUser, INTERNAL } from '../lib/request';\n\nimport {\n  setPaymentProfile,\n  getPaymentProfile\n} from './paymentActions';\n\nexport const GET_USER_START = 'GET_USER_START';\nexport const getUserStart = () => ({\n  type: GET_USER_START\n})\n\nexport const GET_USER_SUCCESS = 'GET_USER_SUCCESS';\nexport function getUserSuccess(data) {\n  return {type: GET_USER_SUCCESS, data}\n}\n\nexport const GET_USER_FAILED = 'GET_USER_FAILED';\nexport function getUserFailed() {\n  return {type: GET_USER_FAILED}\n}\n\nexport const GET_ACCOUNTS_SUCCESS = 'GET_ACCOUNTS_SUCCESS';\nexport function getAccountsSuccess(data) {\n  return {type: GET_ACCOUNTS_SUCCESS, data}\n}\n\nexport const getUser = () => {\n  return async (dispatch) => {\n    dispatch(getUserStart());\n\n    try{\n      const user = await ssoUser();\n\n      // if get user failed\n      if(!user) \n        return dispatch(getUserFailed());\n\n      // token have expired\n      if(user.expires_at < (new Date().valueOf()/1000)) \n        return dispatch(getUserFailed());\n\n      dispatch(getUserSuccess({ ...user }));\n      setUser(user);\n      await dispatch(getAccounts());\n\n    }catch(e){\n      console.error(e);\n      dispatch(getUserFailed());\n    }\n\n  }\n}\n\n\nexport const LOGGED_IN_SUCCESS = 'LOGGED_IN_SUCCESS';\nexport function logInSuccess(data) {\n  return { type: LOGGED_IN_SUCCESS, data}\n}\nexport const logIn = () => {\n  return async (dispatch) => {\n      const user = await ssoLogin();\n      dispatch(getUser())\n  }\n}\n\n\nexport const LOG_OUT_SUCCESS = 'LOG_OUT_SUCCESS';\nexport function logOutSuccess() {\n  return { type: LOG_OUT_SUCCESS }\n}\nexport const logOut = () => {\n  return async (dispatch) => {\n      await ssoLogout();\n      setUser({});\n      dispatch(logOutSuccess())\n  }\n}\n\nexport const getAccounts = ( fetchPaymentProfile = true ) => async dispatch => {\n  const resp = await INTERNAL.GET('/accounts');\n  dispatch(getAccountsSuccess(resp.data))\n\n  if(!fetchPaymentProfile) return;\n  \n  resp.data.forEach(async (account, i) => {\n\n    if(!account.paymentId) return dispatch(setPaymentProfile(account.aid, null));\n    dispatch(getPaymentProfile(account, account.paymentId));\n\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// actions/authActions.js","\nimport { UserManager, WebStorageStateStore } from 'oidc-client';\nimport getConfig from 'next/config'\n\nconst manager = () => {\n\nconst { publicRuntimeConfig } = getConfig();\nconst settings = {\n  authority: publicRuntimeConfig.OIDC_AUTHORITY,\n  client_id: publicRuntimeConfig.OIDC_CLIENTID,\n  redirect_uri: publicRuntimeConfig.OIDC_REDIRECT,\n  popup_redirect_uri: publicRuntimeConfig.OIDC_REDIRECT,\n  silent_redirect_uri: publicRuntimeConfig.OIDC_REDIRECT_SILENT,\n  post_logout_redirect_uri: publicRuntimeConfig.OIDC_POST_LOGOUT,\n  scope: 'openid profile reed_payment_portal',\n  response_type: 'id_token token',\n  filterProtocolClaims: true,\n  automaticSilentRenew: true,\n  userStore: process.browser ? new WebStorageStateStore({store: window.localStorage }) : null\n};\n\n  return process.browser ? new UserManager(settings) : {\n    getUser: () => {} ,\n    signinRedirect: () => {},\n    signoutRedirect: () => {},\n    signinRedirectCallback: () => {} ,\n    signinSilentCallback: () => {}\n  };\n}\n\nexport const ssoUser = () => manager().getUser();\nexport const ssoLogin = () => manager().signinRedirect();\nexport const ssoLogout = () => manager().signoutRedirect();\nexport const ssoCallback = () => manager().signinRedirectCallback();\nexport const ssoSilentCallback = () => manager().signinSilentCallback();\n\n\n\n// WEBPACK FOOTER //\n// lib/sso-auth.js"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAEA;AAKA;AACA;AAAA;AACA;AADA;AAAA;AAIA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAIA;AACA;AALA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAcA;AACA;AAfA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAmBA;AACA;AACA;AArBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAwBA;AAGA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AACA;AACA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAIA;AAGA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAEA;AACA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAKA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AACA;AACA;AAHA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAGA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAPA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;AAxEA;AACA;AAIA;AACA;AAIA;AACA;AAIA;AACA;AAIA;AA4BA;AACA;AAGA;AAQA;AACA;AAGA;AAQA;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/EA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAXA;AAcA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;;;;;;;;;;;;AA9BA;AA0BA;AACA;AACA;AACA;AACA;;;;;;;;;A","sourceRoot":""}